<head>
	<title>OpenGarage</title>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="//code.jquery.com/mobile/1.3.1/jquery.mobile-1.3.1.min.css" type="text/css">
	<script src="//code.jquery.com/jquery-1.9.1.min.js" type="text/javascript"></script>
	<script src="//code.jquery.com/mobile/1.3.1/jquery.mobile-1.3.1.min.js" type="text/javascript"></script>
</head>

<body>
	<style>
		table,
		th,
		td {
			border: 0px solid black;
			padding: 6px;
			border-collapse: collapse;
		}

		.img {
			width: inherit;
			height: inherit;
			position: absolute;
			top: inherit;
			left: inherit;
		}

		.img[src=""] {
			display: none;
		}

		.lightlock-ctrl div.ui-slider-switch {
			width: 160px;
		}
	</style>

	<div data-role="page" id="page_home">
		<div data-role="header">
			<h3 id="head_name">OG</h3>
		</div>

		<div data-role="content">
			<div data-role="fieldcontain">
				<table>
					<tr>
						<td><b>Door:<br></b></td>
						<td><label id="lbl_status">-</label></td>
						<td rowspan="2">
							<div id="pic" style="width:112px;height:64px;">
								<img id="car_pic" src="" class="img">
								<img id="door_pic" src="" class="img">
								<img id="arrow_pic" src="" class="img">
							</div>
						</td>
					</tr>

					<tr>
						<td><b><label id="lbl_vstatus1">Vehicle:</label></b></td>
						<td><label id="lbl_vstatus">-</label></td>
					</tr>

					<tr>
						<td><b>Distance:</b></td>
						<td><label id="lbl_dist">-</label></td>
						<td></td>
					</tr>

					<tr>
						<td><b>Read Cnt.:</b></td>
						<td><label id="lbl_beat">-</label></td>
						<td></td>
					</tr>

					<tr id="tbl_sn2" style="display:none">
						<td><b>Switch Sn. :</b></td>
						<td><label id="lbl_sn2">-</label></td>
						<td></td>
					</tr>

					<tr id="tbl_obstruct" style="display:none">
						<td><b>Obstructed:</b></td>
						<td><label id="lbl_obstruct">-</label></td>
						<td></td>
					</tr>

					<tr id="tbl_pemu" style="display:none">
						<td><b>Panel Emu.:</b></td>
						<td><label id="lbl_pemu">-</label></td>
						<td></td>
					</tr>

					<tr>
						<td><b>WiFi Signal:</b></td>
						<td colspan="2"><label id="lbl_rssi">-</label></td>
					</tr>

					<tr>
						<td><b>Cloud:</b></td>
						<td colspan="2"><label id="lbl_cld">-</label></td>
					</tr>

					<tr id="tbl_th">
						<td><b>T/H sensor:</b></td>
						<td colspan="2"><label id="lbl_th">-</label></td>
					</tr>

					<tr>
						<td><b>Device Key:</b></td>
						<td colspan="2">
							<input type="password" size="20" maxlength="64" name="dkey" id="dkey"
								data-clear-btn="true">
						</td>
					</tr>

					<tr>
						<td colspan="3"><label id="msg"></label></td>
					</tr>
				</table>

				<div class="lightlock-ctrl" style="display:none">
					<label for="lightflip" class="ui-hidden-accessible"></label>
					<select name="lightflip" id="lightflip" data-theme="e" data-role="slider">
						<option value="0">Light Off</option>
						<option value="1">Light On</option>
					</select>

					<label for="lockflip" class="ui-hidden-accessible"></label>
					<select name="lockflip" id="lockflip" data-theme="e" data-role="slider">
						<option value="0">Lock Inactive</option>
						<option value="1">Lock Active</option>
					</select>
				</div>

				<span style="display:block;height:5px"></span>
				<div data-role="controlgroup" data-type="horizontal">
					<button data-theme="b" id="btn_click">Door</button>
					<button data-theme="b" id="btn_opts">Options</button>
					<button data-theme="b" id="btn_log">View Log</button>
				</div>

				<span style="display:block;height:5px"></span>
				<div data-role="controlgroup" data-type="horizontal">
					<button data-theme="c" id="btn_rbt">Reboot</button>
					<button data-theme="c" id="btn_rap">Reset WiFi</button>
					<button data-theme="c" id="btn_cll">Clear Log</button>
				</div>
			</div>
		</div>

		<div data-role="footer" data-theme="c">
			<p>&nbsp; OpenGarage Firmware v<label id="fwv">-</label>
				<div data-role="controlgroup" data-type="horizontal">
					<a href="update" target="_top" data-role="button" data-inline=true data-mini=true>Firmware
						Update</a>
					<a href="https://opengarage.github.io/OpenGarage-Firmware/1.2.4/manual/" target="_blank"
						data-role="button" data-inline=true data-mini=true>User Manual</a>
				</div>
			</p>
		</div>
	</div>

	<script>
		var si;

		function clear_msg() {
			$('#msg').text('');
		}

		function show_msg(s, t, c) {
			$('#msg').text(s).css('color', c);
			if (t > 0) setTimeout(clear_msg, t);
		}

		function get_and_save_dkey() {
			var dkey_val = $('#dkey').val();
			localStorage.setItem('og_dkey', dkey_val);
			return dkey_val;
		}

		$('#btn_opts').click(function (e) {
			window.open('vo', '_top');
		});

		$('#btn_log').click(function (e) {
			window.open('vl', '_top');
		});

		$('#btn_cll').click(function (e) {
			if (confirm('Clear log data?')) {
				var comm = 'clearlog?dkey=' + encodeURIComponent(get_and_save_dkey());
				clear_msg();
				$.getJSON(comm, function (jd) {
					if (jd.result != 1) show_msg('Check device key and try again.', 2000, 'red');
					else {
						show_msg('Log data cleared', 2000, 'green');
					}
				});
			}
		});

		$('#btn_rbt').click(function (e) {
			if (confirm('Reboot the device now?')) {
				var comm = 'cc?reboot=1&dkey=' + encodeURIComponent(get_and_save_dkey());
				clear_msg();
				$.getJSON(comm, function (jd) {
					if (jd.result != 1) show_msg('Check device key and try again.', 2000, 'red');
					else {
						show_msg('Rebooting. Please wait...', 0, 'green');
						clearInterval(si);
						setTimeout(function () {
							location.reload(true);
						}, 10000);
					}
				});
			}
		});

		$('#btn_rap').click(function (e) {
			if (confirm('Reset the device to AP mode?')) {
				var comm = 'cc?apmode=1&dkey=' + encodeURIComponent(get_and_save_dkey());
				clear_msg();
				$.getJSON(comm, function (jd) {
					if (jd.result != 1) show_msg('Check device key and try again.', 2000, 'red');
					else {
						clearInterval(si);
						$('#msg').html('Device is now in AP mode. Log on<br>to SSID OG_xxxxxx, then <br> click <a href="http://192.168.4.1">http://192.168.4.1</a><br>to configure.').css('color', 'green');
					}
				});
			}
		});

		function do_action_command(comm) {
			var comm = 'cc?' + comm + '&dkey=' + encodeURIComponent(get_and_save_dkey());
			$.getJSON(comm)
				.done(function (jd) {
					if (jd.result != 1) {
						show_msg('Check device key and try again.', 2000, 'red');
					} else {
						clear_msg();
					}
				})
				.fail(function (jqxhr, textStatus, error) {
					var err = error;
					$('#msg').text('Request Failed: ' + err).css('color', 'red');
				});
		}

		$('#dkey').on('input change', function () {
			if ($(this).val() === '') {
				localStorage.removeItem('og_dkey');
				show_msg('Cleared saved key.', 1500, 'green');
			}
		});

		$('#lightflip').on('change', function (e) {
			do_action_command('light=toggle');
		});

		$('#lockflip').on('change', function (e) {
			do_action_command('lock=toggle');
		});

		$('#btn_click').click(function (e) {
			do_action_command('click=1');
		});

		$(document).ready(function () {
			var savedKey = localStorage.getItem('og_dkey');
			if (savedKey) {
				$('#dkey').val(savedKey);
			}
			show();
			si = setInterval('show()', 2000);
		});

		const svgs = {
			partial: "data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+Cjxzdmcgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgdmlld0JveD0iMCAwIDQ0OCAyNTYiIHZlcnNpb249IjEuMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSIgeG1sbnM6c2VyaWY9Imh0dHA6Ly93d3cuc2VyaWYuY29tLyIgc3R5bGU9ImZpbGwtcnVsZTpldmVub2RkO2NsaXAtcnVsZTpldmVub2RkO3N0cm9rZS1saW5lam9pbjpyb3VuZDtzdHJva2UtbWl0ZXJsaW1pdDoyOyI+CiAgICA8ZyB0cmFuc2Zvcm09Im1hdHJpeCgwLjk5NzUwNiwwLDAsMSw0OS45OTc1LDApIj4KICAgICAgICA8ZyB0cmFuc2Zvcm09Im1hdHJpeCgxLjY1OTQzLDAsMCwxLjg2MDI3LDI1LjYyNTcsLTQuMDAxODMpIj4KICAgICAgICAgICAgPHBhdGggZD0iTTIyNSw2LjE4M0wyMjUsMTQuMjQ2QzIyNSwxNi40NzEgMjIyLjk3LDE4LjI3OCAyMjAuNDY5LDE4LjI3OEw0OC4yOTQsMTguMjc4QzQ1Ljc5MywxOC4yNzggNDMuNzYzLDE2LjQ3MSA0My43NjMsMTQuMjQ2TDQzLjc2Myw2LjE4M0M0My43NjMsMy45NTggNDUuNzkzLDIuMTUxIDQ4LjI5NCwyLjE1MUwyMjAuNDY5LDIuMTUxQzIyMi45NywyLjE1MSAyMjUsMy45NTggMjI1LDYuMTgzWiIvPgogICAgICAgIDwvZz4KICAgICAgICA8ZyB0cmFuc2Zvcm09Im1hdHJpeCg1LjQxMjQ3ZS0xNywtMC44ODI4MjMsMS44NjQ5MiwxLjE0NDc3ZS0xNiwzNjQuOTExLDE5OC42MzUpIj4KICAgICAgICAgICAgPHBhdGggZD0iTTIyNSw2LjE4M0wyMjUsMTQuMjQ2QzIyNSwxNi40NzEgMjIxLjE5MywxOC4yNzggMjE2LjUwNSwxOC4yNzhMNTIuMjU5LDE4LjI3OEM0Ny41NywxOC4yNzggNDMuNzYzLDE2LjQ3MSA0My43NjMsMTQuMjQ2TDQzLjc2Myw2LjE4M0M0My43NjMsMy45NTggNDcuNTcsMi4xNTEgNTIuMjU5LDIuMTUxTDIxNi41MDUsMi4xNTFDMjIxLjE5MywyLjE1MSAyMjUsMy45NTggMjI1LDYuMTgzWiIvPgogICAgICAgIDwvZz4KICAgIDwvZz4KPC9zdmc+Cg==",
			open: "data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+Cjxzdmcgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgdmlld0JveD0iMCAwIDQ0OCAyNTYiIHZlcnNpb249IjEuMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSIgeG1sbnM6c2VyaWY9Imh0dHA6Ly93d3cuc2VyaWYuY29tLyIgc3R5bGU9ImZpbGwtcnVsZTpldmVub2RkO2NsaXAtcnVsZTpldmVub2RkO3N0cm9rZS1saW5lam9pbjpyb3VuZDtzdHJva2UtbWl0ZXJsaW1pdDoyOyI+CiAgICA8ZyB0cmFuc2Zvcm09Im1hdHJpeCgwLjk5NzUwNiwwLDAsMSw0OC45OTc1LDApIj4KICAgICAgICA8ZyB0cmFuc2Zvcm09Im1hdHJpeCgyLjIxMjU3LDAsMCwxLjg2MDI3LC05Ny44MjkxLC00LjAwMTgzKSI+CiAgICAgICAgICAgIDxwYXRoIGQ9Ik0yMjUsNi4xODNMMjI1LDE0LjI0NkMyMjUsMTYuNDcxIDIyMy40NzcsMTguMjc4IDIyMS42MDIsMTguMjc4TDQ3LjE2MSwxOC4yNzhDNDUuMjg2LDE4LjI3OCA0My43NjMsMTYuNDcxIDQzLjc2MywxNC4yNDZMNDMuNzYzLDYuMTgzQzQzLjc2MywzLjk1OCA0NS4yODYsMi4xNTEgNDcuMTYxLDIuMTUxTDIyMS42MDIsMi4xNTFDMjIzLjQ3NywyLjE1MSAyMjUsMy45NTggMjI1LDYuMTgzWiIvPgogICAgICAgIDwvZz4KICAgICAgICA8ZyB0cmFuc2Zvcm09Im1hdHJpeCgyLjcwMjg1ZS0xNywtMC40NDE0MTEsMS44NjQ5MiwxLjE0MTkzZS0xNiwzNjUuOTEzLDk5LjMxNzUpIj4KICAgICAgICAgICAgPHBhdGggZD0iTTIyNSw2LjE4M0wyMjUsMTQuMjQ2QzIyNSwxNi40NzEgMjE3LjM4NywxOC4yNzggMjA4LjAwOSwxOC4yNzhMNjAuNzU0LDE4LjI3OEM1MS4zNzcsMTguMjc4IDQzLjc2MywxNi40NzEgNDMuNzYzLDE0LjI0Nkw0My43NjMsNi4xODNDNDMuNzYzLDMuOTU4IDUxLjM3NywyLjE1MSA2MC43NTQsMi4xNTFMMjA4LjAwOSwyLjE1MUMyMTcuMzg3LDIuMTUxIDIyNSwzLjk1OCAyMjUsNi4xODNaIi8+CiAgICAgICAgPC9nPgogICAgPC9nPgo8L3N2Zz4K",
			closed: "data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+Cjxzdmcgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgdmlld0JveD0iMCAwIDQ0OCAyNTYiIHZlcnNpb249IjEuMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSIgeG1sbnM6c2VyaWY9Imh0dHA6Ly93d3cuc2VyaWYuY29tLyIgc3R5bGU9ImZpbGwtcnVsZTpldmVub2RkO2NsaXAtcnVsZTpldmVub2RkO3N0cm9rZS1saW5lam9pbjpyb3VuZDtzdHJva2UtbWl0ZXJsaW1pdDoyOyI+CiAgICA8ZyB0cmFuc2Zvcm09Im1hdHJpeCgxLDAsMCwxLDQ4LDApIj4KICAgICAgICA8ZyB0cmFuc2Zvcm09Im1hdHJpeCgwLjQ0MTQxMSwwLDAsMS44NjAyNywzMDAuNjgyLC00LjAwMTgzKSI+CiAgICAgICAgICAgIDxwYXRoIGQ9Ik0yMjUsNi4xODNMMjI1LDE0LjI0NkMyMjUsMTYuNDcxIDIxNy4zODcsMTguMjc4IDIwOC4wMDksMTguMjc4TDYwLjc1NCwxOC4yNzhDNTEuMzc3LDE4LjI3OCA0My43NjMsMTYuNDcxIDQzLjc2MywxNC4yNDZMNDMuNzYzLDYuMTgzQzQzLjc2MywzLjk1OCA1MS4zNzcsMi4xNTEgNjAuNzU0LDIuMTUxTDIwOC4wMDksMi4xNTFDMjE3LjM4NywyLjE1MSAyMjUsMy45NTggMjI1LDYuMTgzWiIvPgogICAgICAgIDwvZz4KICAgICAgICA8ZyB0cmFuc2Zvcm09Im1hdHJpeCg4LjY0OTE3ZS0xNywtMS40MTI1MiwxLjg2MDI3LDEuMTM5MDllLTE2LDM2NS45OTgsMzE3LjgxNikiPgogICAgICAgICAgICA8cGF0aCBkPSJNMjI1LDYuMTgzTDIyNSwxNC4yNDZDMjI1LDE2LjQ3MSAyMjIuNjIxLDE4LjI3OCAyMTkuNjksMTguMjc4TDQ5LjA3MywxOC4yNzhDNDYuMTQyLDE4LjI3OCA0My43NjMsMTYuNDcxIDQzLjc2MywxNC4yNDZMNDMuNzYzLDYuMTgzQzQzLjc2MywzLjk1OCA0Ni4xNDIsMi4xNTEgNDkuMDczLDIuMTUxTDIxOS42OSwyLjE1MUMyMjIuNjIxLDIuMTUxIDIyNSwzLjk1OCAyMjUsNi4xODNaIi8+CiAgICAgICAgPC9nPgogICAgPC9nPgo8L3N2Zz4K",
			car: "data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+Cjxzdmcgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgdmlld0JveD0iMCAwIDQ0OCAyNTYiIHZlcnNpb249IjEuMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSIgeG1sbnM6c2VyaWY9Imh0dHA6Ly93d3cuc2VyaWYuY29tLyIgc3R5bGU9ImZpbGwtcnVsZTpldmVub2RkO2NsaXAtcnVsZTpldmVub2RkO3N0cm9rZS1saW5lam9pbjpyb3VuZDtzdHJva2UtbWl0ZXJsaW1pdDoyOyI+CiAgICA8ZyB0cmFuc2Zvcm09Im1hdHJpeCgtMC42NzEyODMsMCwwLDAuNjcxMjgzLDM4NC4wMTEsLTI1Ljg4MzIpIj4KICAgICAgICA8Zz4KICAgICAgICAgICAgPHBhdGggZD0iTTQ5OS44NzUsMjE5LjcwN0w0OTMuNDcxLDIxMC43MTFDNDg3LjMyOSwyMDIuMDc5IDQ3OC41OTIsMTg3LjI4OSA0NzMuOTk5LDE3Ny43NDJMNDQyLjQxMywxMTIuMDk2QzQzNy4wMTYsMTAwLjg3NSA0MjMuMDM0LDkyLjA4NSA0MTAuNTc5LDkyLjA4NUwxOTIuMTg2LDkyLjA4NUMxNzkuOTMxLDkyLjA4NSAxNjUuMTI3LDEwMC4xNTIgMTU4LjQ3OCwxMTAuNDVMMTAwLjM1NCwyMDAuNTI0Qzk1LjEwMSwyMDguNjY1IDgyLjY5LDIxNy4zOSA3My4yNSwyMTkuNTc3TDIyLjMxLDIzMS4zODJDMTAuMDA5LDIzNC4yMzIgMCwyNDYuODI3IDAsMjU5LjQ1NkwwLDM0OC4yNTJDMCwzNjEuMzU1IDEwLjY2MSwzNzIuMDE2IDIzLjc2NCwzNzIuMDE2TDYxLjcyMywzNzIuMDE2QzY5Ljc3NSwzOTkuNjU3IDk1LjMxOSw0MTkuOTE3IDEyNS41MjIsNDE5LjkxN0MxNTUuNzI2LDQxOS45MTcgMTgxLjI3LDM5OS42NTcgMTg5LjMyMiwzNzIuMDE2TDMxMi41NTMsMzcyLjAxNkMzMjAuNjA2LDM5OS42NTcgMzQ2LjE1LDQxOS45MTcgMzc2LjM1NCw0MTkuOTE3QzQwNi41NTYsNDE5LjkxNyA0MzIuMTAxLDM5OS42NTcgNDQwLjE1MywzNzIuMDE2TDQ4OC4yMzYsMzcyLjAxNkM1MDEuMzQxLDM3Mi4wMTYgNTEyLDM2MS4zNTUgNTEyLDM0OC4yNTJMNTEyLDI1Ny42NTZDNTEyLDI0NS45MyA1MDYuNjc2LDIyOS4yNiA0OTkuODc1LDIxOS43MDdaTTEyNS41MjIsMzg2LjQ3QzEwNy4yOTMsMzg2LjQ3IDkyLjUxMiwzNzEuNjg4IDkyLjUxMiwzNTMuNDU5QzkyLjUxMiwzMzUuMjI4IDEwNy4yOTMsMzIwLjQ1IDEyNS41MjIsMzIwLjQ1QzE0My43NTMsMzIwLjQ1IDE1OC41MzMsMzM1LjIyOCAxNTguNTMzLDM1My40NTlDMTU4LjUzMywzNzEuNjg4IDE0My43NTMsMzg2LjQ3IDEyNS41MjIsMzg2LjQ3Wk0zMTMuODc0LDIxOS42MDRMMTQ3LjM0OCwyMTkuNjA0QzEzOC42NjUsMjE5LjYwNCAxMzUuMjYzLDIxMy41NCAxMzkuNzg5LDIwNi4xM0wxODEuOTAyLDEzNy4xNTNDMTg2LjQyNiwxMjkuNzQyIDE5Ny4yMzMsMTIzLjY3OSAyMDUuOTE1LDEyMy42NzlMMzEzLjg3NCwxMjMuNjc5TDMxMy44NzQsMjE5LjYwNFpNMzc2LjM1NCwzODYuNDdDMzU4LjEyMywzODYuNDcgMzQzLjM0MywzNzEuNjg4IDM0My4zNDMsMzUzLjQ1OUMzNDMuMzQzLDMzNS4yMjggMzU4LjEyMywzMjAuNDUgMzc2LjM1NCwzMjAuNDVDMzk0LjU4MywzMjAuNDUgNDA5LjM2MywzMzUuMjI4IDQwOS4zNjMsMzUzLjQ1OUM0MDkuMzYzLDM3MS42ODggMzk0LjU4MywzODYuNDcgMzc2LjM1NCwzODYuNDdaTTQyNC40OTIsMjE5LjYwNEwzNTEuODYxLDIxOS42MDRMMzUxLjg2MSwxMjMuNjc3TDM5My4wNjYsMTIzLjY3N0M0MDEuNzQ5LDEyMy42NzcgNDExLjA2NSwxMzAuNDI3IDQxMy43NjgsMTM4LjY4TDQzNS4zNjUsMjA0LjYwMUM0MzguMDY5LDIxMi44NTEgNDMzLjE3NiwyMTkuNjA0IDQyNC40OTIsMjE5LjYwNFoiIHN0eWxlPSJmaWxsOnJnYigxNzksMTc5LDE3OSk7ZmlsbC1ydWxlOm5vbnplcm87Ii8+CiAgICAgICAgPC9nPgogICAgPC9nPgo8L3N2Zz4K",
			arrow_up: "data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+Cjxzdmcgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgdmlld0JveD0iMCAwIDQ0OCAyNTYiIHZlcnNpb249IjEuMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSIgeG1sbnM6c2VyaWY9Imh0dHA6Ly93d3cuc2VyaWYuY29tLyIgc3R5bGU9ImZpbGwtcnVsZTpldmVub2RkO2NsaXAtcnVsZTpldmVub2RkO3N0cm9rZS1saW5lam9pbjpyb3VuZDtzdHJva2UtbWl0ZXJsaW1pdDoyOyI+CiAgICA8ZyB0cmFuc2Zvcm09Im1hdHJpeCg1LjMwMTY4ZS0xNywwLjg2NTgzLC0wLjM1MDk3MiwyLjE0OTA4ZS0xNyw0NzYuMDc4LC0xMzMuMTY2KSI+CiAgICAgICAgPHBhdGggZD0iTTIxNy4zMjQsMTM3LjY5N0wyMTcuMzI0LDE2NS40NzdMMjAwLDEyMi43MzhMMjE3LjMyNCw4MEwyMTcuMzI0LDEwNy43OEwzMTUuNDk2LDEwNy43OEwzMTUuNDk2LDEzNy42OTdMMjE3LjMyNCwxMzcuNjk3WiIgc3R5bGU9ImZpbGw6d2hpdGU7Ii8+CiAgICA8L2c+Cjwvc3ZnPgo=",
			arrow_down: "data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+Cjxzdmcgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgdmlld0JveD0iMCAwIDQ0OCAyNTYiIHZlcnNpb249IjEuMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSIgeG1sbnM6c2VyaWY9Imh0dHA6Ly93d3cuc2VyaWYuY29tLyIgc3R5bGU9ImZpbGwtcnVsZTpldmVub2RkO2NsaXAtcnVsZTpldmVub2RkO3N0cm9rZS1saW5lam9pbjpyb3VuZDtzdHJva2UtbWl0ZXJsaW1pdDoyOyI+CiAgICA8ZyB0cmFuc2Zvcm09Im1hdHJpeCg1LjMwMTY4ZS0xNywwLjg2NTgzLC0wLjM1MDk3MiwyLjE0OTA4ZS0xNyw0NzYuMDc4LC0xMzMuMTY2KSI+CiAgICAgICAgPHBhdGggZD0iTTIwMCwxMzcuNjk3TDIwMCwxMDcuNzhMMjk4LjE3MiwxMDcuNzhMMjk4LjE3Miw4MEwzMTUuNDk2LDEyMi43MzhMMjk4LjE3MiwxNjUuNDc3TDI5OC4xNzIsMTM3LjY5N0wyMDAsMTM3LjY5N1oiIHN0eWxlPSJmaWxsOndoaXRlOyIvPgogICAgPC9nPgo8L3N2Zz4K"
		};

		function show() {
			$.ajax({
				url: 'jc',
				dataType: 'JSON',
				timeout: 5000,
				success: function (jd) {
					$('#fwv').text((jd.fwv / 100 >> 0) + '.' + (jd.fwv / 10 % 10 >> 0) + '.' + (jd.fwv % 10 >> 0));
					$('#lbl_dist').text(jd.dist + ' (cm)').css('color', jd.dist == 450 ? 'red' : 'black');

					let status_text;
					let status_color;
					const door_img = document.getElementById('door_pic');
					const arrow_img = document.getElementById('arrow_pic');

					switch (jd.door) {
						case 0: // Closed
							status_text = 'CLOSED';
							status_color = 'green';
							door_img.src = svgs.closed;
							arrow_img.src = '';
							break;
						case 1: // Open
							status_text = 'OPENED';
							status_color = 'red';
							door_img.src = svgs.open;
							arrow_img.src = '';
							break;
						case 2: // Stopped
							status_text = 'STOPPED';
							status_color = 'orange';
							door_img.src = svgs.partial;
							arrow_img.src = '';
							break;
						case 3: // Closing
							status_text = 'CLOSING';
							status_color = 'green';
							door_img.src = svgs.partial;
							arrow_img.src = svgs.arrow_down;
							break;
						case 4: // Opening
							status_text = 'OPENING';
							status_color = 'red';
							door_img.src = svgs.partial;
							arrow_img.src = svgs.arrow_up;
							break;
						default:
							status_text = 'UNKNOWN';
							status_color = 'violet';
							break;
					}

					$('#lbl_status').text(status_text).css('color', status_color);

					if (typeof (jd.light) == 'undefined' || typeof (jd.lock) == 'undefined') {
						$('.lightlock-ctrl').hide();
					} else {
						$('.lightlock-ctrl').show();
						$('#lightflip').val(jd.light).slider('refresh');
						$('#lockflip').val(jd.lock).slider('refresh');
					}

					if (jd.vehicle >= 2) {
						$('#lbl_vstatus1').hide();
						$('#lbl_vstatus').text('');
					} else {
						$('#lbl_vstatus1').show();
						$('#lbl_vstatus').text(jd.vehicle == 1 ? 'Present' : (jd.vehicle == 0 ? 'Absent' : 'Unavailable'));
					}

					const car_img = document.getElementById('car_pic');
					if (jd.vehicle < 3 && jd.vehicle > 0) {
						car_img.src = svgs.car;
						car_img.style.filter = jd.vehicle == 1 ? 'brightness(0)' : '';
					} else {
						car_img.src = '';
					}

					if (typeof (jd.sn2) != 'undefined') {
						$('#tbl_sn2').show();
						$('#lbl_sn2').text(jd.sn2 ? 'High' : 'Low');
					} else {
						$('#tbl_sn2').hide();
					}

					$('#lbl_beat').text(jd.rcnt).css('color', 'black');
					$('#lbl_rssi').text((jd.rssi > -71 ? 'Good' : (jd.rssi > -81 ? 'Weak' : 'Poor')) + ' (' + jd.rssi + ' dBm)');

					if (jd.cld == 0) $('#lbl_cld').text('None');
					else if (jd.cld == 1) $('#lbl_cld').text('Blynk ' + ['(disconnected)', '(connected)'][jd.clds]);
					else $('#lbl_cld').text('OTC ' + ['(not enabled)', '(connecting...)', '(disconnected)', '(connected)'][jd.clds]);

					$('#head_name').text(jd.name);
					$('#btn_click').html(jd.door >= 2 ? 'Toggle Door' : (jd.door ? 'Close Door' : 'Open Door')).button('refresh');

					if (typeof (jd.temp) != 'undefined') {
						$('#tbl_th').show();
						$('#lbl_th').text(jd.temp.toFixed(1) + String.fromCharCode(176) + 'C / ' + (jd.temp * 1.8 + 32).toFixed(1) + String.fromCharCode(176) + 'F (H:' + jd.humid.toFixed(1) + '%)');
					} else {
						$('#tbl_th').hide();
					}

					if (typeof (jd.pemu) != 'undefined') {
						$('#tbl_pemu').show();
						switch (jd.pemu) {
							case 2: // DETECTING
								$('#lbl_pemu').text('Detecting Wall Panel...').css('color', 'violet');
								break;
							case 1: // ACTIVE
								$('#lbl_pemu').text('Active').css('color', 'green');
								break;
							default: // INACTIVE
								$('#lbl_pemu').text('Inactive');
								break;
						}
					} else {
						$('#tbl_pemu').hide();
					}

					if (typeof (jd.obstruct) != 'undefined') {
						$('#tbl_obstruct').show();
						$('#lbl_obstruct').text(jd.obstruct ? 'YES' : 'no').css('color', jd.obstruct ? 'red' : '');
					} else {
						$('#tbl_obstruct').hide();
					}
				},
				error: function () {
					$('#lbl_beat').text('(offline)').css('color', 'red');
					$('#lbl_cld').text('disconnected');
				}
			});
		}
	</script>
</body>
